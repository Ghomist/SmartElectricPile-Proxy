# 部分技术文档

## 目录

-   [通讯总架构](#通讯总架构)
-   [协议介绍](#协议介绍)
-   [网关架构](#网关架构)
-   [前端架构](#前端架构)
-   [底层架构](#底层架构)
-   [设备层接口](#设备层接口)

## 通讯总架构

一套完整的 IoT 体系一般由以下四个部分组成（由上至下依次）：

-   [应用侧](#应用侧)：由用户可见的前端产品组成，如小程序、网页、APP 等，承担与用户交互的任务；
-   [云平台](#云平台)：云端总管数据、指令，也是各类数据的汇总、分析处；
-   [集群与网关](#集群与网关)：在云平台与多台设备（设备集群）之间实现数据或命令的整合、转发等功能，分担云平台与设备的计算任务；
-   [终端设备](#终端设备)：实地工作的设备、硬件，需承担绝大多数的测量、监测任务。

各层次互相通讯，且只与相邻的层级通讯，保证了各个层级的分工明确，效率最大化。

### 应用侧

> 应用侧最重要的部分是与用户交互，需要明确**交互的对象是一般用户、企业管理，而非专业的工程师**。所以设计图形界面的首要任务是**简单、易用、用户友好**。

可选的应用有：

-   网络页面
-   小程序（本质同上）
-   桌面应用程序
-   移动设备应用程序
-   ……

应用侧只需负责调用云平台数据，而不应进行过多运算、处理；下发指令时只向云平台发送指令，由云平台下发至对应网关。

一般而言，发送指令后会收到来自平台的返回消息（http 中的返回消息一般包含在请求的响应体中），该返回消息由用户自行于网关/设备侧定义，用于表示指令执行成功与否，或其它信息。

应用侧使用的主流网络协议一般为 http/https、AMQPS。

### 云平台

> 部署在云端的 mqtt 服务器。一般集成数据库、网站服务器软件等。

一般而言推荐选择已有的 IoT 云平台产品，如各大厂商的云平台应用。主流平台一般有：华为云、阿里云等等。

可选的方案是在云服务器上直接部署 mqtt broker（如 mosquitto 一类的 mqtt broker 应用），但这样需要个人/小团队开发者花费大量时间设计、维护该 broker，也会有一定安全隐患。

云平台通常将一套完整的 IoT 按层级规划如下：

-   产品：拥有一个产品模型，规定了该产品所拥有的属性、可选指令等内容
    -   一个产品拥有若干个设备
-   设备：对应通讯架构中的网关
    -   云平台可以实时显示网关设备上传的数据
    -   云平台可以实时对网关设备下发指令进行调试
    -   一个设备可以拥有多个子设备

### 集群与网关

> 根据边缘计算的设计思想，为了分离云平台过大的计算任务，且考虑到终端设备算力一般并不高，于是需要终端设备将原始数据上传至网关，由网关设备运算、整理后再上传至云平台。同理，云平台下发的指令也需经过网关设备转发。

推荐的方式是使用云平台提供的 sdk，可以将更多的时间花费在设计网关模型上，而非攻克技术壁垒。

可选的方案是自建网关。

自建网关需要在网关设备上（实验阶段可直接使用 pc 或树莓派）编写代码，并根据云平台提供的 api 与其交互。

### 终端设备

> 承担了几乎所有的测量、监测任务，该部分作为通讯体系中绝大多数数据的来源地，也是通讯体系中最底层的一个部分。

一般而言，终端设备获取数据后，只需稍作处理便可上传至网关设备，等待进一步处理和上传。

_嵌入式、以及硬件技术部分参见嵌入式技术指南。_

## 协议介绍

### http/https

_Hyper Text Transfer Protocol_，超文本传输协议，是一个基于简单的**请求-响应模式**的协议。https 是 http 协议的安全加密（_secure_）版本，使用 SSL/TLS 协议进行了加密处理，相较于 http 明文传输数据，https 更加安全。

### mqtt

_Message Queuing Telemetry Transport_，消息队列遥测传输协议，是一种基于**订阅-发布模式**的轻量级协议。部分平台使用加密的数据进行传输，也叫 mqtts，与 mqtt 大体保持一致。

## 网关架构

### cloud-side-client

### local-side-client

## 前端架构

## 底层架构

## 设备层接口

### Topic

### payload format
